<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Laundry System - Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
        .app-container { max-width: 1000px; width: 95%; margin: 20px auto; background: white; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
        .view { display: none; padding: 2rem; }
        .primary-btn { background-color: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.3s, transform 0.1s; }
        .primary-btn:hover { background-color: #2563eb; }
        .primary-btn:active { transform: scale(0.98); }
        .secondary-btn { background-color: #e5e7eb; color: #374151; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.3s; }
        .secondary-btn:hover { background-color: #d1d5db; }
        .tab-btn { display: inline-block; padding: 0.25rem 0.75rem; font-size: 0.875rem; border-bottom-width: 2px; border-color: transparent; }
        .tab-btn:hover { border-color: #9ca3af; }
        .tab-btn.active { border-color: #3b82f6; color: #3b82f6; font-weight: 700; }
        .card { background-color: #f9fafb; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
        
        /* สไตล์ปุ่มช่องเวลา */
        .slot-button {
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 0.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
            font-size: 0.875rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .slot-button:hover {
            background-color: #eff6ff;
            border-color: #3b82f6;
            color: #2563eb;
        }
        /* (ในอนาคต) .slot-button.booked { background-color: #f3f4f6; color: #9ca3af; cursor: not-allowed; } */
    </style>
</head>
<body>

<div class="app-container">
    <nav id="navbar" class="p-4 border-b border-gray-100 flex justify-between items-center rounded-t-xl bg-gray-50">
        <h1 class="text-2xl font-bold text-gray-800">Laundry Hub</h1>
        <div class="flex space-x-4 items-center">
            <div id="nav-tabs" class="space-x-2">
                <a href="/student/dashboard" class="tab-btn">Dashboard</a>
                <a href="booking.html" id="nav-booking-link" class="tab-btn active">Booking</a>
                </div>
            <span id="user-info" class="text-sm text-gray-600 font-medium hidden sm:inline"></span>
        </div>
    </nav>

    <div id="message-box" class="fixed top-5 right-5 z-50"></div>
    
    <div id="booking-view" class="view">
        <h2 class="text-3xl font-bold mb-6 text-gray-800">Select a Machine and Time</h2>
        
        <div id="machine-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <p>Loading machines...</p>
        </div>
    </div>

    <div id="confirm-view" class="view">
        <h2 class="text-3xl font-bold mb-6 text-gray-800">Confirm Your Booking</h2>
        <div class="card max-w-lg mx-auto">
            <p class="text-lg text-gray-600 mb-4">Please confirm the details below:</p>
            <ul class="space-y-3 mb-6">
                <li class="flex justify-between items-center">
                    <span class="font-medium text-gray-500">User:</span>
                    <span id="confirm-user" class="text-lg font-semibold text-gray-800"></span>
                </li>
                <li class="flex justify-between items-center">
                    <span class="font-medium text-gray-500">Machine:</span>
                    <span id="confirm-machine" class="text-lg font-semibold text-gray-800"></span>
                </li>
                <li class="flex justify-between items-center">
                    <span class="font-medium text-gray-500">Time Slot:</span>
                    <span id="confirm-slot" class="text-lg font-semibold text-gray-800"></span>
                </li>
            </ul>
            <div class="flex justify-between space-x-4">
                <button id="cancel-booking-btn" class="w-full text-center py-3 rounded-lg secondary-btn">Cancel</button>
                <button id="submit-booking-btn" class="w-full text-center py-3 rounded-lg primary-btn">Confirm & Request Approval</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- GLOBAL DATA & STATE ---
    const users = [
        { id: 'S12345', email: 'student@uni.edu', password: '123', role: 'Student', name: 'Alice Student' },
    ];
    let currentUser = users[0]; // Auto-login as Alice Student
    
    let pendingBooking = null;

    // --- UTILITIES ---
    function showMessage(message, type = 'info') {
        const baseClass = "p-4 mb-2 rounded-lg shadow-lg text-white font-semibold transition-opacity duration-300";
        let colorClass = type === 'success' ? 'bg-emerald-500' : (type === 'error' ? 'bg-red-500' : 'bg-blue-500');
        const $msg = $(`<div class="${baseClass} ${colorClass}">${message}</div>`);
        $('#message-box').append($msg);
        $msg.fadeIn(300).delay(3000).fadeOut(500, function() { $(this).remove(); });
    }

    function showView(viewId) {
        $('.view').hide();
        $(`#${viewId}`).show();
    }

    // --- AUTHENTICATION LOGIC ---
    function authenticateUser(user) {
        $('#navbar').removeClass('hidden');
        $('#user-info').text(`${user.name} (${user.role})`).show();
        showView('booking-view');
    }

    // --- NEW: FUNCTION TO RENDER MACHINES AND SLOTS ---
    function renderMachineSlots() {
        const $list = $('#machine-list').empty();
        
        const machineNames = ['Washer 1', 'Washer 2', 'Washer 3', 'Washer 4'];
        
        // 8 ช่องเวลา, 1 ชั่วโมงต่อช่อง
        const timeSlots = [
            '09:00', '10:00', '11:00', '12:00', 
            '13:00', '14:00', '15:00', '16:00'
        ];

        machineNames.forEach(machineName => {
            // สร้างปุ่มช่องเวลา 8 ปุ่ม
            let slotButtonsHTML = '';
            timeSlots.forEach(slotTime => {
                slotButtonsHTML += `
                    <button class="slot-button" 
                            data-machine-name="${machineName}" 
                            data-slot-time="${slotTime}">
                        ${slotTime}
                    </button>
                `;
            });

            // สร้างการ์ดสำหรับเครื่องนี้
            const machineCardHTML = `
                <div class="card">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">${machineName}</h3>
                    <div class="grid grid-cols-4 gap-2">
                        ${slotButtonsHTML}
                    </div>
                </div>
            `;
            
            $list.append(machineCardHTML);
        });
    }
    
    // --- BOOKING LOGIC ---

    // 1. Handle click on a time slot button (NEW)
    $('#machine-list').on('click', '.slot-button', function() {
        const machineName = $(this).data('machine-name');
        const startTime = $(this).data('slot-time');
        
        // คำนวณเวลาสิ้นสุด (1 ชั่วโมง)
        const startHour = parseInt(startTime.split(':')[0]);
        const endTime = `${String(startHour + 1).padStart(2, '0')}:00`;
        
        pendingBooking = {
            user: currentUser.name,
            machine: machineName, // เก็บชื่อเครื่องที่เลือก
            slot: `${startTime} - ${endTime}` // เก็บช่วงเวลา 1 ชม.
        };

        // Populate confirmation view
        $('#confirm-user').text(pendingBooking.user);
        $('#confirm-machine').text(pendingBooking.machine);
        $('#confirm-slot').text(pendingBooking.slot);
        
        showView('confirm-view');
    });

    // 2. Handle Cancel button
    $('#cancel-booking-btn').on('click', function() {
        pendingBooking = null;
        showView('booking-view');
    });

    // 3. Handle Submit button -> Save to session and REDIRECT
    $('#submit-booking-btn').on('click', function() {
        if (!pendingBooking) return;
        
        try {
            // บันทึกข้อมูลการจองลง sessionStorage
            sessionStorage.setItem('pendingBooking', JSON.stringify(pendingBooking));
            
            // ไปยังหน้า timer.html
            window.location.href = 'timer.html';

        } catch (e) {
            console.error('Error saving to sessionStorage', e);
            showMessage('Could not proceed with booking. Please try again.', 'error');
        }
    });

    // --- INITIALIZATION ---
    $(document).ready(function() {
        authenticateUser(currentUser);
        renderMachineSlots(); // สร้างรายการเครื่องและช่องเวลาเมื่อหน้าโหลด
    });

</script>
</body>
</html>