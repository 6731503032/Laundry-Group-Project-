<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Details - Laundry Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #F3F4F6; }
        .rating-star { color: #FBBF24; }
        .rating-star.empty { color: #D1D5DB; }
    </style>
</head>
<body class="min-h-screen p-6 flex justify-center items-center">

    <div class="max-w-4xl w-full bg-white rounded-2xl shadow-xl overflow-hidden">
        <div class="p-4 bg-gray-50 border-b flex justify-between items-center">
            <a href="javascript:history.back()" class="text-blue-600 font-semibold flex items-center hover:underline">
                ‚Üê Back to Dashboard
            </a>
            <span th:if="${currentUser != null}" class="text-gray-500 text-sm" th:text="${currentUser.name}">User</span>
        </div>

        <div class="md:flex">
            <div class="md:w-1/3 bg-blue-50 p-8 flex flex-col items-center text-center border-r border-blue-100">
                <div class="w-40 h-40 bg-white rounded-full flex items-center justify-center shadow-md mb-6 text-6xl">
                    <span th:if="${machine.machineType == 'WASHER'}">üßº</span>
                    <span th:if="${machine.machineType == 'DRYER'}">üî•</span>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-1" th:text="${machine.name}">Washer A</h1>
                <p class="text-blue-600 font-semibold mb-6" th:text="${machine.machineNumber}">W-001</p>
                
                <div class="bg-white p-4 rounded-xl shadow-sm w-full mb-4">
                    <p class="text-sm text-gray-500 mb-1">Status</p>
                    <span class="px-3 py-1 rounded-full text-sm font-bold"
                          th:classappend="${machine.status == 'AVAILABLE' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}"
                          th:text="${machine.status}">AVAILABLE</span>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-sm w-full">
                    <p class="text-sm text-gray-500 mb-1">Price per Load</p>
                    <p class="text-2xl font-bold text-gray-800" th:text="${machine.pricePerHour + ' ‡∏ø'}">40 ‡∏ø</p>
                </div>
            </div>

            <div class="md:w-2/3 p-8">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800 mb-2">Specifications</h2>
                        <div class="grid grid-cols-2 gap-x-8 gap-y-2 text-sm">
                            <div><span class="text-gray-500">Brand:</span> <span class="font-medium" th:text="${machine.brand ?: 'N/A'}">Samsung</span></div>
                            <div><span class="text-gray-500">Model:</span> <span class="font-medium" th:text="${machine.model ?: 'N/A'}">WF-5000</span></div>
                            <div><span class="text-gray-500">Type:</span> <span class="font-medium" th:text="${machine.machineType}">WASHER</span></div>
                            <div><span class="text-gray-500">Capacity:</span> <span class="font-medium" th:text="${machine.capacity != null ? machine.capacity + ' kg' : 'N/A'}">10 kg</span></div>
                        </div>
                    </div>
                    
                    <div class="bg-amber-50 border border-amber-100 rounded-xl p-3 text-center">
                        <div class="text-3xl font-bold text-amber-500" th:text="${#numbers.formatDecimal(averageRating, 1, 1)}">4.5</div>
                        <div class="flex text-lg">
                             <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                   class="rating-star" 
                                   th:classappend="${i > averageRating} ? 'empty'">‚òÖ</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1" th:text="${totalRatings + ' reviews'}">120 reviews</p>
                    </div>
                </div>

                <div class="mb-8">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Description</h2>
                    <p class="text-gray-600 leading-relaxed" th:text="${machine.description ?: 'No description available for this machine.'}">
                        High-efficiency front-load washer with steam cycle for deep cleaning.
                    </p>
                </div>

                <a th:if="${machine.status == 'AVAILABLE' and currentUser != null}"
                   th:href="@{/student/{uid}/booking?machineId={mid}(uid=${currentUser.studentId}, mid=${machine.id})}"
                   class="block w-full py-4 bg-blue-600 hover:bg-blue-700 text-white text-center font-bold rounded-xl transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                    Book This Machine Now
                </a>
                
                <button th:if="${machine.status != 'AVAILABLE'}" disabled
                        class="block w-full py-4 bg-gray-300 text-gray-500 text-center font-bold rounded-xl cursor-not-allowed">
                    Currently Unavailable
                </button>

                <div class="mt-10 pt-8 border-t">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Recent Reviews</h3>
                    <div class="space-y-4 max-h-64 overflow-y-auto pr-2">
                        <div th:each="review : ${recentReviews}" class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex justify-between mb-1">
                                <span class="font-semibold text-sm" th:text="${review.userName}">User Name</span>
                                <div class="flex text-amber-400 text-sm">
                                    <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                          th:text="${i <= review.rating ? '‚òÖ' : '‚òÜ'}"></span>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm italic" th:text="|&quot;${review.reviewText}&quot;|">"Great machine!"</p>
                            <p class="text-xs text-gray-400 mt-2" th:text="${#temporals.format(review.createdAt, 'dd MMM yyyy')}">Date</p>
                        </div>
                        <p th:if="${#lists.isEmpty(recentReviews)}" class="text-gray-500 text-sm italic">No reviews yet.</p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</body>
</html>